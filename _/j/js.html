<head><meta charset="utf-8"><title>j</title></head>
<link rel=icon href='data:;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABSSURBVDhPY/wPBAwUACYozcDAyAjBhACaOoQBZAKCBjACbQNhXID2LgCFMb5wHgJeIARoYwAhfyMD2nqBGFdgNQA93slKB7AEhE8zCFCYnRkYAOS/HR/UGSYjAAAAAElFTkSuQmCC'>
<style>

 html{font-family:monospace;}
 body{overflow:hidden}
 textarea{background:black;color:#cccccc;resize:none;border:none}textarea:focus{color:white;}
 #term{position:absolute;width:40%;height:100%;left:0;top:0;background:#ffffea;color:black}
 #run{position:absolute;top:0;right:60%;font-family:monospace}
 #cnv{position:absolute;width:60%;height:70%;right:0;top:0}
 #deb{position:absolute;width:60%;height:30%;right:0;bottom:0}
 
</style>
<script src=pako.min.js></script><!--zip/unzip url-->
<script>

var J,JJ,C,U,I,B,jj,ctx
function ge(x){return document.getElementById(x)};
function us(s){return new TextEncoder("utf-8").encode(s)}
function su(u){return new TextDecoder("utf-8").decode(u)}
function sy(x,u){console.log(sy,x);u=[];x>>>=2;while(x>0){u.push(96+x%32);x>>>=5};return su(new Uint8Array(u.reverse()))}
function input(t,a,b,s){a=t.selectionStart;b=t.selectionEnd;s=t.value;return (b-a)>0?s.substring(a,b):s}
function surl(){window.location.hash=btoa(c1(pako.deflate(us(term.value))))}
function gurl(x){x=window.location.hash.slice(1);try{return x?su(pako.inflate(c0(atob(x)))):''}catch(x){return''}}
function c1(x,r,i){r='';for(i=0;i<x.length;i++)r+=chr(x[i]);return r};var chr=String.fromCharCode;
function c0(x,r,i){r=new Uint8Array(x.length);for(i=0;i<x.length;i++)r[i]=x.charCodeAt(i);return r}
function run(w,h){surl();
 w=cnv.clientWidth;h=cnv.clientHeight;cnv.width=w;cnv.height=h;
 jtry(us(input(term).replaceAll("\n"," ")),w,h)
 // deb.value=term.value
 // 
 //ctx.fillStyle="green";ctx.fillRect(5,5,w-10,h-10);}
}
function jtry(u,w,h){C.set(B);asi("w",w);asi("h",h);jju(jj);
 try     {jju(u);JJ(33);JJ(10);}
 catch(e){console.log(e);deb.value="!"}}
function jju(u){for(var i=0;i<u.length;i++)JJ(u[i])}
function stk(x){deb.value=X(U[1])}
function X(x){return(x==0)?"!!":(!(x&7))?LX(x):(x&1)?(x>>1).toString():(x&2)?sy(x):(x&4)?chr(33+(x>>>3)):"!!!"}
function LX(x,n){n=nn(x);x=2+(x>>>2);var r=new Array(n);for(var i=0;i<n;i++)r[i]=X(U[x+i]);return "["+r.join(" ")+"]"}
function SX(x,n){n=nn(x);x=2+(x>>>2);var r=new Uint8Array(n);for(var i=0;i<n;i++)r[i]=U[x+i]>>1;return su(r)}
function AX(x,n,u){n=nn(x);x=2+(x>>>2);var r=new Array(n);for(var i=0;i<n;i++){u=U[x+i];r[i]=(u&1)?u>>1:sy(u)};return r}
function nn(x){return U[1+(x>>>2)]}
function asi(s,v){JJ(91);jju(us((v).toString()));JJ(93);JJ(91);jju(us(s));JJ(93);JJ(58)}
function draw(x,y){console.log("draw",x,y,nn(x),nn(y));if((0!=(x&7))||(0!=(y&7)))return;var a=AX(x);var s=SX(y);
 console.log("s",s,"a",a)
 if(typeof(ctx[s])==="function")ctx[s](...a);else ctx[s]=a
}


</script>


<body>
<textarea id="term" class="term" wrap="off" spellcheck="false"></textarea>
<button   id="run" onclick="run()">run</button>
<canvas   id="cnv"></canvas>
<textarea id="deb" class="term" wrap="off" spellcheck="false" readonly></textarea>
<script>term=ge("term");cnv=ge("cnv");deb=ge("deb");ctx=cnv.getContext('2d')

//var jjb;function jstr(){var r=new TextDecoder("utf-8").decode(new Uint8Array(jjb.slice(1)));jjb=[];return r}
//JJ=function(x){jjb.push(x);J.exports.j(x)}
function jload(){fetch('j.j').then(r=>r.arrayBuffer()).then(u=>jj=new Uint8Array(u))}
function msl(){var b=J.exports.mem.buffer;C=new Uint8Array(b);U=new Uint32Array(b);I=new Int32Array(b);JJ=J.exports.j;JJ(16);B=C.slice(0);jload()}
fetch('j.wasm').then(r=>r.arrayBuffer()).then(r=>WebAssembly.instantiate(r,{"ext":{"stk":stk,"draw":draw} })).then(r=>{J=r.instance;msl();})

term.value=gurl()
deb.value=""
</script>

</body></html>
